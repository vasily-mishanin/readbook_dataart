(this["webpackJsonpjs-academy-js-6-final__read-book__vasily-mishanin"]=this["webpackJsonpjs-academy-js-6-final__read-book__vasily-mishanin"]||[]).push([[0],{13:function(e,t,n){e.exports={loader:"LoaderFade_loader__3fous",hidden:"LoaderFade_hidden__2XSoD",loading:"LoaderFade_loading__3E3mH"}},21:function(e,t,n){},22:function(e,t,n){},25:function(e,t,n){"use strict";n.r(t);var s=n(1),o=n.n(s),a=n(12),i=n.n(a),c=(n(21),n(22),n(0));var r=function(e){return Object(c.jsx)("div",{className:"App",children:e.children})},l=n(2),d=n.n(l),u=n(5),h=n(6),j=n(3),b=n(4),f=n(16),k=n(14),O=function(e){return Object(c.jsx)("div",{className:"booklist__header",children:e.children})},x=n(15),p=function(e){var t=e.onSearch,n=e.onChange,o=e.onEnter,a=Object(s.useState)(null),i=Object(x.a)(a,2),r=i[0],l=i[1],d=Object(s.useCallback)((function(e){l(e.target.value)}),[]);return Object(c.jsxs)("div",{className:"searchbox",children:[Object(c.jsx)("input",{className:"searchbox__input",type:"text",name:"searchInput",autoComplete:"on",placeholder:"Author or title ...",onChange:function(e){return n(e.target.value)},onKeyDown:function(e){return o(e)},onInput:d}),Object(c.jsx)("button",{className:"searchbox__button",onClick:function(){return t()},disabled:!r,children:"Go!"})]})},v=function(e,t){return e&&e.length>t?"".concat(e.slice(0,t),"..."):e},g=function(e){var t,n=e.book,s=e.onBookCardClick,o=n.title,a=n.subtitle,i=n.language,r=n.isSelected;return o=v(o,30),a=v(a,30),i=v((t=i)?"(".concat(t.join(", "),")"):"",22),Object(c.jsxs)("article",{className:"booklist__card ".concat(r?"checked":""),onClick:function(){return s(n)},children:[" ",Object(c.jsxs)("h3",{children:[" ",o," ",Object(c.jsx)("span",{children:i})," "]})," ",Object(c.jsx)("h4",{className:"muted",children:a})," "]})},m=n(13),_=n.n(m),L=function(){return Object(c.jsxs)("h1",{className:_.a.loader,children:[Object(c.jsx)("span",{children:"L"}),Object(c.jsx)("span",{children:"O"}),Object(c.jsx)("span",{children:"A"}),Object(c.jsx)("span",{children:"D"}),Object(c.jsx)("span",{children:"I"}),Object(c.jsx)("span",{children:"N"}),Object(c.jsx)("span",{children:"G"})]})},C=function(e){var t=e.content,n=e.isLoading,s=e.onScroll,o=e.onBookCardClick;return Object(c.jsxs)("div",{className:"booklist__content",onScroll:function(e){return s(e)},children:[n&&Object(c.jsx)(L,{}),t.map((function(e){return Object(c.jsx)(g,{book:e,onBookCardClick:o},e._id)}))]})},S=function(e){var t=e.listInfo,n=e.onNextClick,s=e.onPrevClick;return Object(c.jsxs)(o.a.Fragment,{children:[Object(c.jsxs)("div",{className:"booklist__footer-info",children:[Object(c.jsxs)("p",{children:["Found: ",Object(c.jsx)("span",{children:t.booksFound})," "]}),Object(c.jsxs)("p",{children:["Start: ",Object(c.jsx)("span",{children:t.start})," "]}),Object(c.jsxs)("p",{children:["Page size: ",Object(c.jsx)("span",{children:t.pageSize})," "]})]}),Object(c.jsxs)("div",{className:"booklist__footer-controls",children:[" ",Object(c.jsx)("button",{name:"previous",onClick:function(){return s()},children:"Prev. results"}),Object(c.jsx)("button",{name:"next",onClick:function(){return n()},children:"Next. results"})]})]})},y=function(e){var t=e.listInfo,n=e.onNextClick,s=e.onPrevClick;return Object(c.jsx)("footer",{className:"booklist__footer",children:t.booksFound&&Object(c.jsx)(S,{listInfo:t,onNextClick:n,onPrevClick:s})})},N=function(e){var t=e.booksList,n=e.isLoading,s=e.listInfo,a=e.onChange,i=e.onEnter,r=e.onSearch,l=e.onScroll,d=e.onNextClick,u=e.onPrevClick,h=e.onBookCardClick;return Object(c.jsx)(o.a.Fragment,{children:Object(c.jsxs)("section",{className:"booklist",children:[Object(c.jsx)(O,{children:Object(c.jsx)(p,{onChange:a,onEnter:i,onSearch:r})}),Object(c.jsx)(C,{content:t,isLoading:n,onScroll:l,onBookCardClick:h}),Object(c.jsx)(y,{listInfo:s,onNextClick:d,onPrevClick:u})]})})},B=function(e){var t,n=e.bookDetails,s=e.onAddBookClick,o=n.title,a=n.subtitle,i=n.language,r=n.has_fulltext,l=n.first_publish_year,d=n.publish_year,u=function(e){return e&&Array.isArray(e)?"".concat(e.join(", ")):0===e?"unknown":e};d=u(d),l=u(l),i=(t=i)?"(".concat(t.join(", "),")"):"";var h=Object.keys(n).length>0;return Object(c.jsxs)("article",{className:"details",children:[Object(c.jsx)("h2",{className:"details__heading",children:"Book details"}),h&&Object(c.jsxs)("div",{children:[Object(c.jsx)("h1",{className:"details__title",children:o}),Object(c.jsx)("h2",{className:"details__title muted",children:a}),Object(c.jsxs)("p",{children:["Languages avalable: ",Object(c.jsx)("span",{children:i||"no information"})," "]}),Object(c.jsxs)("p",{children:["Full text available:"," ",r?Object(c.jsx)("span",{style:{color:"#ffd933"},children:"yes"}):Object(c.jsx)("span",{style:{color:"#c72c41"},children:" not "})," "]}),Object(c.jsxs)("p",{children:["First publish year: ",Object(c.jsx)("span",{children:l||"no information"})," "]}),Object(c.jsxs)("p",{children:["Years published: ",Object(c.jsx)("span",{children:d||"no information"})," "]}),Object(c.jsx)("button",{onClick:function(){return s(n)},children:"Add book to Read List"})]})]})},R=function(e){var t,n=e.book,s=e.onMarkAsRead,o=e.onRemove,a=n.title,i=n.subtitle,r=n.language,l=n.author_name;return a=v(a,30),i=v(i,30),r=v((t=r)?"(".concat(t.join(", "),")"):"",22),Object(c.jsxs)("article",{className:"readinglist__to-read-book-card",children:[Object(c.jsxs)("h3",{children:[a," ",Object(c.jsx)("span",{children:r})]}),Object(c.jsx)("h4",{className:"muted",children:i}),Object(c.jsx)("h2",{children:l}),Object(c.jsxs)("button",{name:"btn_markAsRead",onClick:function(){return s(n)},children:[" ","Mark as read"]}),Object(c.jsxs)("button",{name:"btn_remove",onClick:function(){return o(n)},children:[" ","Remove from list"," "]})]})},I=function(e){var t,n=e.book,s=n.title,o=n.subtitle,a=n.language,i=n.author_name;return s=v(s,30),o=v(o,30),a=v((t=a)?"(".concat(t.join(", "),")"):"",22),Object(c.jsxs)("article",{className:"readinglist__finished-book-card",children:[Object(c.jsxs)("h3",{children:[s," ",Object(c.jsx)("span",{children:a})]}),Object(c.jsx)("h4",{className:"muted",children:o}),Object(c.jsx)("h2",{children:i})]})},P=function(e){var t=e.toReadList,n=e.finishedBooksList,s=e.onMarkAsRead,o=e.onRemove,a=t.length+n.length,i=n.length;return Object(c.jsxs)("section",{className:"readinglist",children:[Object(c.jsxs)(O,{children:[" ",Object(c.jsx)("h1",{className:"readinglist__title",children:"To read list..."}),Object(c.jsxs)("p",{className:"readinglist__info",children:[Object(c.jsx)("span",{children:a})," books, ",i," read"]})]}),Object(c.jsxs)("div",{className:"readinglist__content",children:[t.map((function(e){return Object(c.jsx)(R,{book:e,onMarkAsRead:s,onRemove:o},e._id)})),n.map((function(e){return Object(c.jsx)(I,{book:e},e._id)}))]})]})},A=n(8),F=n(10),w=Object(F.a)("apiURL"),T=function(){function e(t){Object(j.a)(this,e),Object.defineProperty(this,w,{writable:!0,value:void 0}),Object(A.a)(this,w)[w]=t}return Object(b.a)(e,[{key:"get",value:function(){var e=Object(h.a)(d.a.mark((function e(t){var n,s,o;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n="".concat(Object(A.a)(this,w)[w]).concat(t),e.prev=1,e.next=4,fetch(n);case 4:if(!(s=e.sent).ok){e.next=10;break}return e.next=8,s.json();case 8:return o=e.sent,e.abrupt("return",o);case 10:console.log("Request to ".concat(n," finished with ").concat(s.status)),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(1),console.error("Request to ".concat(n," failed with error:"),e.t0);case 16:return e.prev=16,console.log("Request to ".concat(n," is done")),e.finish(16);case 19:case"end":return e.stop()}}),e,this,[[1,13,16,19]])})));return function(t){return e.apply(this,arguments)}}()}]),e}(),M=Object(F.a)("ApiClient"),E=function(){function e(){Object(j.a)(this,e)}return Object(b.a)(e,null,[{key:"getBooks",value:function(){var t=Object(h.a)(d.a.mark((function t(n,s){var o,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o="".concat(n,"&page=").concat(s),t.next=3,Object(A.a)(e,M)[M].get(o);case 3:return a=t.sent,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}()}]),e}();Object.defineProperty(E,M,{writable:!0,value:new T("https://openlibrary.org/search.json?q=")});var Q=function(){function e(){Object(j.a)(this,e)}return Object(b.a)(e,null,[{key:"setReadList",value:function(e){localStorage.setItem("readList",JSON.stringify(e))}},{key:"setFinishedList",value:function(e){localStorage.setItem("finishedList",JSON.stringify(e))}},{key:"readList",get:function(){var e=localStorage.getItem("readList");return e?JSON.parse(e):[]}},{key:"finishedList",get:function(){var e=localStorage.getItem("finishedList");return e?JSON.parse(e):[]}},{key:"addBookToReadList",value:function(t){var n=e.readList;n.some((function(e){return e._id===t._id}))||e.setReadList([].concat(Object(u.a)(n),[t]))}},{key:"deleteBook",value:function(t){var n=e.readList.filter((function(e){return e._id!==t._id}));e.setReadList(n)}},{key:"addBookToFinishedList",value:function(t){var n=e.finishedList;n.some((function(e){return e._id===t._id}))||e.setFinishedList([].concat(Object(u.a)(n),[t]))}}]),e}(),D=function(e){Object(f.a)(n,e);var t=Object(k.a)(n);function n(e){var s;return Object(j.a)(this,n),(s=t.call(this,e)).state={searchQuery:"",booksList:[],isLoading:!1,prevLists:[],currentPage:1,listInfo:{booksFound:null,start:null,pageSize:100},selectedBook:{}},s.WAIT_TIMEOUT_ms=3e3,s.debouncedSearch=s.debounce((function(){return s.handleSearch()}),s.WAIT_TIMEOUT_ms),s.handleSearch=Object(h.a)(d.a.mark((function e(){var t,n,o,a,i,c,r,l,h,j,b;return d.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.state,n=t.searchQuery,o=t.currentPage,a=t.prevLists,console.log("Search:",n,o),n!==s.lastQuery&&(o=1,a=[]),i=[],s.setState({isLoading:!0}),e.next=7,E.getBooks(n,o);case 7:c=e.sent,r=c.docs,l=c.numFound,h=c.start,s.setState({isLoading:!1}),(i=Object(u.a)(r)).forEach((function(e){return e._id=e.key.split("/").pop()})),j=r.length,b={booksFound:l,start:h,pageSize:j},s.lastQuery=n,s.setState({booksList:i,currentPage:o,listInfo:b,prevLists:[].concat(Object(u.a)(a),[{page:o,list:i,listInfo:b}])}),console.log("State.booksList:",s.state.booksList);case 17:case"end":return e.stop()}}),e)}))),s.handleInputChange=function(e){var t=e;s.setState({searchQuery:t})},s.handleEnter=function(e){"Enter"===e.key&&s.handleSearch()},s.handleNextClick=function(){if(s.isAnyMoreBooks()){var e=s.state.currentPage+1;s.setState({currentPage:e})}},s.handlePrevClick=function(){var e=s.state.currentPage;if(e>1){var t=e-1;s.setState({currentPage:t})}},s.handleScroll=function(e){if(s.isAnyMoreBooks()){var t=e.target,n=t.scrollHeight;if(t.scrollTop+t.clientHeight>=n-5){var o=s.state.currentPage+1;e.target.scrollTop=5,s.setState({currentPage:o})}}},s.handleBookCardClick=function(e){var t=s.state.booksList,n=t.find((function(e){return!0===e.isSelected}));if(!n||n._id!==e._id){if(n){var o=t.indexOf(n);t[o].isSelected=!1}var a=t.indexOf(e);t[a].isSelected=!0,s.setState({booksList:t,selectedBook:e})}},s.handleAddBookClick=function(e){var t=s.state.toReadList;t.some((function(t){return t._id===e._id}))||(Q.addBookToReadList(e),s.setState({toReadList:[].concat(Object(u.a)(t),[e])}))},s.handleMarkAsRead=function(e){var t=s.state.finishedBooksList;t.some((function(t){return t._id===e._id}))||(Q.addBookToFinishedList(e),s.setState({finishedBooksList:[].concat(Object(u.a)(t),[e])}))},s.handleRemove=function(e){var t=s.state.toReadList.filter((function(t){return t._id!==e._id}));Q.deleteBook(e),s.setState({toReadList:t})},s.isAnyMoreBooks=function(){var e=s.state.currentPage,t=s.state.listInfo,n=t.pageSize,o=t.booksFound;return 100===n&&o>100*e},s.lastQuery=s.state.searchQuery,s.state.toReadList=Q.readList,s.state.finishedBooksList=Q.finishedList,s}return Object(b.a)(n,[{key:"componentDidMount",value:function(){}},{key:"componentDidUpdate",value:function(e,t){var n=this.state,s=n.searchQuery,o=n.currentPage,a=n.prevLists;if(o!==t.currentPage){var i=a.find((function(e){return e.page===o}));if(i){var c=i.list,r=i.listInfo,l=r.booksFound,d=r.start,u=r.pageSize;this.setState({booksList:c,listInfo:{booksFound:l,start:d,pageSize:u}})}else o>t.currentPage&&this.handleSearch()}s!==t.searchQuery&&this.debouncedSearch()}},{key:"debounce",value:function(e,t){var n=null;return function(){for(var s=arguments.length,o=new Array(s),a=0;a<s;a++)o[a]=arguments[a];window.clearTimeout(n),n=window.setTimeout((function(){e.apply(null,o)}),t)}}},{key:"render",value:function(){var e=this.state,t=e.booksList,n=e.isLoading,s=e.listInfo,o=e.selectedBook,a=e.toReadList,i=e.finishedBooksList,r=this.handleInputChange,l=this.handleEnter,d=this.handleSearch,u=this.handleNextClick,h=this.handlePrevClick,j=this.handleScroll,b=this.handleBookCardClick,f=this.handleAddBookClick,k=this.handleMarkAsRead,O=this.handleRemove;return Object(c.jsxs)("main",{className:"booklist-app",children:[Object(c.jsx)(N,{booksList:t,isLoading:n,listInfo:s,onChange:r,onEnter:l,onSearch:d,onNextClick:u,onPrevClick:h,onScroll:j,onBookCardClick:b}),Object(c.jsx)(B,{bookDetails:o,onAddBookClick:f}),Object(c.jsx)(P,{toReadList:a,finishedBooksList:i,onMarkAsRead:k,onRemove:O})]})}}]),n}(s.Component),z=function(e){e&&e instanceof Function&&n.e(3).then(n.bind(null,26)).then((function(t){var n=t.getCLS,s=t.getFID,o=t.getFCP,a=t.getLCP,i=t.getTTFB;n(e),s(e),o(e),a(e),i(e)}))};i.a.render(Object(c.jsx)(o.a.StrictMode,{children:Object(c.jsx)(r,{children:Object(c.jsx)(D,{})})}),document.getElementById("root")),z()}},[[25,1,2]]]);
//# sourceMappingURL=main.da3b72c3.chunk.js.map